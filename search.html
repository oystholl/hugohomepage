{{ define "main" }}
	<span id="sidebar-toggle-span">
	<a href="#" id="sidebar-toggle" data-sidebar-toggle=""><i class="fa fa-bars"></i> navigation</a>
	</span>
	<label for="search"></label>
	<input id="search" type="text" placeholder="Search...">
	<br>
	Results:
	<ul id="results">
	</ul>

	{{if .Site.Home.Content }}
	{{.Site.Home.Content}}
	{{else}}
		{{if eq .Site.Language.Lang "fr"}}
			<h1>Personaliser la page d'accueil</h1>
			<p>
			  Le site fonctionne. Ne pas oublier de personaliser cette page avec votre propre contenu. 2 façons de faire :
			</p>
			<ul>
			  <li><b>1. </b> Créer un fichier _index.md dans le dossier content</li>
			  <li><b>2. </b> Configurer le serveur http pour rediriger automatiquement la homepage vers la page de votre choix dans le site</li>
			</ul>
		{{else}}
			<h1>Customize your own home page</h1>
			<p>
			  The site is working. Don't forget to customize this homepage with your own. You typically have 2 choices :
			</p>
			<ul>
			  <li><b>1. </b> Create an _index.md document in the content folder</li>
			  <li><b>2. </b> Configure your server to automatically redirect this home page to one of your documentation pages</li>
			</ul>
		{{end}}
		<p><i class="fa fa-heart fa-4x"></i></p>
	{{ end }}


	<script>
		let myLunrIndex, $results, myPagesIndex;

		// Initialize lunrjs using our generated index file
		function initLunr() {
			// First retrieve the index file
			$.getJSON("js/lunr/PagesIndex.json")
					.done(function(index) {
						myPagesIndex = index;
						console.log("index:", myPagesIndex);

						// Set up lunrjs by declaring the fields we use
						// Also provide their boost level for the ranking
						myLunrIndex = lunr(function() {
							this.field("title", {
								boost: 10
							});
							this.field("tags", {
								boost: 5
							});
							this.field("content");

							// ref is the result item identifier (I chose the page URL)
							this.ref("href");
						});

						// Feed lunr with each file and let lunr actually index them
						myPagesIndex.forEach(function(page) {
							myLunrIndex.add(page);
						});
					})
					.fail(function(jqxhr, textStatus, error) {
						let err = textStatus + ", " + error;
						console.error("Error getting Hugo index flie:", err);
					});
		}

		// Nothing crazy here, just hook up a listener on the input field
		function initUI() {
			$results = $("#results");
			$("#search").keyup(function() {
				$results.empty();

				// Only trigger a search when 2 chars. at least have been provided
				let query = $(this).val();
				if (query.length < 2) {
					return;
				}

				let results = search(query);

				renderResults(results);
			});
		}

		/**
		 * Trigger a search in lunr and transform the result
		 *
		 * @param  {String} query
		 * @return {Array}  results
		 */
		function search(query) {
			// Find the item in our index corresponding to the lunr one to have more info
			// Lunr result:
			//  {ref: "/section/page1", score: 0.2725657778206127}
			// Our result:
			//  {title:"Page1", href:"/section/page1", ...}
			return myLunrIndex.search(query).map(function(result) {
				return myPagesIndex.filter(function(page) {
					return page.href === result.ref;
				})[0];
			});
		}

		/**
		 * Display the 10 first results
		 *
		 * @param  {Array} results to display
		 */
		function renderResults(results) {
			if (!results.length) {
				return;
			}

			// Only show the ten first results
			results.slice(0, 10).forEach(function(result) {
				let $result = $("<li>");
				$result.append($("<a>", {
					href: result.href,
					text: "» " + result.title
				}));
				$results.append($result);
			});
		}

		// Let's get started
		initLunr();

		$(document).ready(function() {
			initUI();
		});
	</script>

{{ end }}